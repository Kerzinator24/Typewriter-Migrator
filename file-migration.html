<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Migration Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">
<div class="container text-center">
  <h1 class="text-3xl font-bold text-gray-800 mb-8">File Migration Tool</h1>
  <div id="dropZonesContainer" class="flex flex-wrap justify-center"></div>
  <button id="migrateBtn" class="migrate-btn bg-blue-500 text-white font-bold py-2 px-4 rounded transition duration-300 hover:bg-blue-700 transform hover:scale-105">Migrate Files</button>
  <div id="progressBar" class="progress-bar hidden bg-gray-300 h-2 rounded-full mt-8"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const selectedOptions = JSON.parse(localStorage.getItem('selectedOptions'));
    const dropZonesContainer = document.getElementById('dropZonesContainer');

    const handleDrop = async (event) => {
      event.preventDefault();
      const items = event.dataTransfer.items;

      // Check if any dropped item is a directory
      const isDirectory = Array.from(items).some(item => item.kind === 'directory');

      // If any dropped item is a directory, handle it
      if (isDirectory) {
        const directory = await new Promise(resolve => {
          const entry = event.dataTransfer.items[0].webkitGetAsEntry();
          entry.createReader().readEntries(entries => resolve(entries));
        });

        // Extract the folder name
        const folderName = directory[0].name;
        handleFolderDrop(folderName);
      }
    };

    const handleClick = () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.webkitdirectory = true; // Allow selecting directories
      input.onchange = (event) => {
        const files = Array.from(event.target.files);
        if (files.length > 0 && files[0].webkitRelativePath) {
          const folderName = files[0].webkitRelativePath.split('/')[0];
          handleFolderDrop(folderName);
        }
      };
      input.click();
    };

    const handleFolderDrop = (folderName) => {
      console.log('Folder dropped:', folderName);
      // Replace drop zone with folder icon and name
      dropZonesContainer.innerHTML = `
      <div class="drop-zone border-2 border-dashed border-gray-300 rounded-md p-8 mb-8 mr-8">
        <p class="text-gray-500">Selected folder: ${folderName}</p>
      </div>
    `;
    };

    // Show only one drop zone after selecting migration options
    if (selectedOptions.length > 0) {
      dropZonesContainer.innerHTML = `
      <div class="drop-zone border-2 border-dashed border-gray-300 rounded-md p-8 mb-8 mr-8">
        <p class="text-gray-500">Click here to select your server's plugin folder</p>
      </div>
    `;
      const dropZone = dropZonesContainer.querySelector('.drop-zone');
      dropZone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZone.classList.add('dragover');
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
      });

      dropZone.addEventListener('drop', (event) => {
        handleDrop(event);
        dropZone.classList.remove('dragover');
      });

      dropZone.addEventListener('click', () => {
        handleClick();
      });
    }

    const migrateBtn = document.getElementById('migrateBtn');
    const progressBar = document.getElementById('progressBar');

    migrateBtn.addEventListener('click', () => {
      // Show loading bar
      progressBar.classList.remove('hidden');

      // Simulate file migration progress
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = `${progress}%`;
        if (progress >= 100) {
          clearInterval(interval);
          progressBar.style.width = '0%';
          // Hide loading bar when migration is complete
          progressBar.classList.add('hidden');
        }
      }, 500);
    });
  });

</script>
</body>
</html>
